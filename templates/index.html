<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | LUMI Lernplattform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        /* Custom Styles */
        body { background-color: #e8f5e9; /* Sehr helles Grün */ }
        .calendar-day { transition: all 0.2s ease-in-out; }
        .calendar-day.active { background-color: #4caf50; color: white; border-radius: 50%; }
        .calendar-day.today { font-weight: bold; border: 2px solid #2e7d32; border-radius: 50%; }
        .calendar-day.selected { background-color: #2e7d32; color: white; border-radius: 50%; }
        #chat-window { scroll-behavior: smooth; }
        .chat-bubble { max-width: 80%; }
        .chat-bubble.user { background-color: #ffffff; align-self: flex-end; }
        .chat-bubble.lumi { background-color: #a5d6a7; /* Weiches Grün */ align-self: flex-start; }
        .is-typing {
            display: flex; align-items: center; padding: 10px 15px;
            background-color: #a5d6a7; border-radius: 20px 20px 20px 5px;
        }
        .is-typing span {
            height: 8px; width: 8px; float: left; margin: 0 1px;
            background-color: #4a5568; display: block; border-radius: 50%; opacity: 0.4;
            animation: 1s ball-beat infinite ease-in-out;
        }
        .is-typing span:nth-of-type(2) { animation-delay: -0.2s; }
        .is-typing span:nth-of-type(3) { animation-delay: -0.4s; }
        @keyframes ball-beat {
            50% { opacity: 1; transform: scale(1.3); }
        }
    </style>
</head>
<body class="text-gray-800 font-sans">
    <div class="flex flex-col md:flex-row h-screen">

        <!-- Linke Spalte: Kalender & Chat -->
        <main class="w-full md:w-2/3 lg:w-3/4 flex flex-col p-4 sm:p-6 bg-white shadow-lg z-10">
            <!-- Header -->
            <header class="flex justify-between items-center pb-4 border-b-2 border-gray-100">
                <div>
                    <h1 class="text-3xl font-bold text-green-800">Hallo Elisa!</h1>
                    <p class="text-gray-500">Was hast du heute Starkes geleistet?</p>
                </div>
                <a href="/logout" class="text-sm text-gray-500 hover:text-red-600 transition">Abmelden <i class="fas fa-sign-out-alt ml-1"></i></a>
            </header>

            <!-- Kalender -->
            <div id="calendar-container" class="my-6">
                <div class="flex justify-between items-center mb-2">
                    <button id="prev-month" class="p-2 rounded-full hover:bg-gray-200"><i class="fas fa-chevron-left"></i></button>
                    <h2 id="month-year" class="text-xl font-semibold"></h2>
                    <button id="next-month" class="p-2 rounded-full hover:bg-gray-200"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div id="calendar-grid" class="grid grid-cols-7 gap-2 text-center"></div>
            </div>

            <!-- Chat Bereich -->
            <div class="flex-grow flex flex-col bg-gray-50 rounded-lg p-4 overflow-hidden">
                <div id="chat-window" class="flex-grow space-y-4 overflow-y-auto pr-2">
                    <!-- Nachrichten werden hier via JS eingefügt -->
                </div>
                <div id="typing-indicator" class="mt-4" style="display: none;">
                    <div class="is-typing"><span></span><span></span><span></span></div>
                </div>
                <form id="chat-form" class="mt-4 flex gap-3">
                    <input type="text" id="chat-input" placeholder="Erzähl LUMI, was du heute gelernt hast..."
                           class="w-full px-4 py-3 bg-white border-2 border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500">
                    <button type="submit" id="send-button"
                            class="bg-green-600 text-white rounded-full w-12 h-12 flex-shrink-0 flex items-center justify-center text-xl hover:bg-green-700 transition-transform transform hover:scale-110">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </main>

        <!-- Rechte Spalte: Briefing Panel -->
        <aside class="w-full md:w-1/3 lg:w-1/4 bg-gray-100 p-6 flex flex-col">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold text-gray-700">LUMIs Briefings</h2>
                 <a href="/api/export" title="Alle Briefings herunterladen" class="text-gray-500 hover:text-green-600"><i class="fas fa-download fa-lg"></i></a>
            </div>
            <p class="text-sm text-gray-500 mb-4">Für dich & Randolph</p>
            <div id="briefing-panel" class="flex-grow bg-white rounded-lg shadow-inner p-4 overflow-y-auto">
                <div id="briefing-content" class="prose prose-sm max-w-none">
                    <p class="text-gray-400">Wähle einen markierten Tag im Kalender oder starte einen neuen Eintrag, um das Briefing hier zu sehen.</p>
                </div>
            </div>
        </aside>

    </div>

    <script>
        // Initialer Prompt für einen verpassten Tag wird vom Backend übergeben
        const missedDayPrompt = {{ missed_day_prompt|tojson }};
    </script>
    <script src="/static/js/app.js"></script>
</body>
</html>